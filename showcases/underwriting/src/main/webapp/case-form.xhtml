<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	template="/WEB-INF/templates/template.xhtml">

	<ui:define name="content">
		<h:head>
			<f:metadata>
				<f:event type="preRenderView" listener="#{caseController.initCaseByParameters()}" />
			</f:metadata>
			<title>Underwriting</title>
		</h:head>
		<h:body>
			<div class="page-header">
				<h1>#{caseController.caseDefinition.name}</h1>
				<p>
						Customer Name:
						#{caseController.caseVariables['customerName']}			
						| Sex:
						#{caseController.caseVariables['customerSex']}			

						| Smoker:
						#{caseController.caseVariables['customerSmoker']}			

				</p>
				<!-- 
				<div>

						<ui:repeat
							value="#{caseController.accomplishedStages}"
							var="stage">
							<div class="arrow-box-accomplished">
								<h:outputText value="#{stage}" />
							</div>
						</ui:repeat>
	
						<div class="arrow-box-current">
							<h:outputText
								value="#{caseController.currentStage}" />
						</div>
	
						<ui:repeat value="#{caseController.futureStages}"
							var="stage">
							<div class="arrow-box-future">
								<h:outputText value="#{stage}" />
							</div>
						</ui:repeat>
					
				</div>
				 -->

			</div>
			
			
			<div class="col-md-4" style="height: 100%">
				<h:panelGroup rendered="#{caseController.activityForbiddenText!=null}">
					<div class="alert alert-danger">
						<bold>#{caseController.activityForbiddenText}</bold>
					</div>
				</h:panelGroup>			

<!-- TASK FORM -->

				<!-- Tasks have to use this page (case-form.xhtml) as template! -->
				<h:panelGroup rendered="#{caseController.selectedTask != null}">
					<div class="">
						<div class="panel-heading">
							<h:form>
							<h:commandLink class="close" aria-hidden="true"
														action="#{caseController.deselectTask()}"
														 value="x">
							</h:commandLink>
							</h:form>
							Task: #{caseController.selectedTask.name}
						</div>
						<div class="panel-body">

							<ui:insert name="task-pre-form" />

							<h:form class="form-horizontal" role="form">
							
								<ui:insert name="task" />
							
								<div style="margin-top: 25px;">
									<div class="row">
										<div class="col-md-6">
											<h:commandLink class="btn btn-normal btn-color submit  bottom-pad"
														action="#{caseController.completeSelectedTask()}"
														 value="Complete Task">
										    </h:commandLink>
							    		</div>
										<div class="col-md-6">							    
											<h:commandLink class="btn btn-normal btn-color submit  bottom-pad"
														action="#{caseController.saveSelectedTask()}"
														 value="Save">
										    </h:commandLink>
										</div>
									</div>
								</div>									
							</h:form>
						</div>
					</div>
				</h:panelGroup>
				
				
<!-- Overview -->
<!--
	<h:panelGroup rendered="#{caseController.selectedTask == null}">

		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title">Some data on case</h3>
			</div>
			<div class="panel-body">... lalala ...</div>
		</div>

	</h:panelGroup>
-->
<!-- END OVERVIEW -->
				
			</div>
			<div class="col-md-1">
			</div>

			<div class="col-md-3">
				<div class="row alert alert-warning">
					<div >
						<h4 >
								Pending Activities
						</h4>
					</div>
					<div class="row">
						<h:dataTable
							value="#{caseController.activeCaseExecutions}"
							var="currentExecution" styleClass="table table-condensed">
							<h:column>
								<h:panelGroup rendered="#{currentExecution.activityType!='casePlanModel'}">
									<h:panelGroup rendered="#{currentExecution.activityType=='processTask'}">
									<span class="icon-service" title="process" style="font-size:200%"></span>
 										#{currentExecution.activityName}											
									</h:panelGroup>									
									<h:panelGroup rendered="#{currentExecution.activityType=='humanTask'}">
									<span class="icon-user" title="user" style="font-size:200%"></span>
										<a href="#{caseController.getTaskFormLink(currentExecution)}">
												#{currentExecution.activityName}											
										</a>
									</h:panelGroup>							        
								</h:panelGroup>
							</h:column>
						</h:dataTable>
					</div>
				</div>
				<div class="row alert alert-info">
					<div >
						<h4 >
							Enabled Activities (Available) 
						</h4>
					</div>
					<div >
<script>					
function radioChanged(activityId) {
  var radioValue = document.querySelector('input[name="radio-'+activityId+'"]:checked').value;
  if(radioValue == 'user') {
      $('#user-' + activityId).prop('disabled', false);
      $('#group-' + activityId).prop('disabled', true);
  }
  else if(radioValue == 'group') {
      $('#user-' + activityId).prop('disabled', true);
      $('#group-' + activityId).prop('disabled', false);
  }
  else {
      $('#user-' + activityId).prop('disabled', true);
      $('#group-' + activityId).prop('disabled', true);
  }
}
</script>
					<h:form>
						<h:dataTable
							value="#{caseController.enabledCaseExecutions}"
							var="act" styleClass="table table-condensed">

							<h:column>
								<h:panelGroup rendered="#{act.activityType=='processTask'}">
									<span class="icon-service" title="process" style="font-size:200%"></span>
								</h:panelGroup>									
								<h:panelGroup rendered="#{act.activityType=='humanTask'}">
							        <span class="icon-user" title="process" style="font-size:200%"></span>
								</h:panelGroup>	
								<a id = "toggle-#{act.id}" href="#">
									#{act.activityName}										
								</a>
								<script>
var toggleButton = document.getElementById('toggle-#{act.id}');
var elementToShow = document.getElementById('div-#{act.id}');

toggleButton.onclick = function() {
  var isHidden = $("#div-#{act.id}").css("display") == "none";
  if (isHidden) {
    $("#div-#{act.id}").css("display", "block");		
  } else {
    $("#div-#{act.id}").css("display", "none");		
  }
};
								</script>
								<div id = "div-#{act.id}" style="display: none;">
									<div class="form-group">
										<fieldset>
										<p>
										<h:selectOneMenu class="form-control" id="assignee" value="#{caseController.assignee}" rendered="#{act.activityType=='humanTask'}">
											<f:selectItem itemValue="john" itemLabel="Demo Demo" />					
											<f:selectItem itemValue="john" itemLabel="John Doe" />
											<f:selectItem itemValue="john" itemLabel="Mary Ann" />
											<f:selectItem itemValue="john" itemLabel="Peter Meter" />

										</h:selectOneMenu>
										</p>
										<p>
										<h:commandLink 
											action="#{caseController.executeCaseActivityAndSelectTask(act)}"
											class="btn btn-primary"
											rendered="#{act.activityType=='humanTask'}">
											Start Human Task
										</h:commandLink>										

										
										<h:commandLink 
											action="#{caseController.executeCaseActivityAndSelectTask(act)}"
											class="btn btn-primary"
											rendered="#{act.activityType=='processTask'}">
											Start Process
										</h:commandLink>
										</p>
										</fieldset>										
									</div>

								</div>
							</h:column>
						</h:dataTable>
					</h:form>
					</div>
				</div>





			</div>
			<div class="col-md-1">
			</div>
			<div class="col-md-3">
				<div class="row alert alert-success">
					<div >
						<h4 > Completed Activities 
						</h4>
					</div>
					<div >
						<div >
							<h:form>
								<h:dataTable
									value="#{caseController.historicCaseActivityInstances}"
									var="activity" styleClass="table table-condensed">

								<h:column>
									<h:panelGroup rendered="#{activity.calledProcessInstanceId!=null}">
									<span class="icon-service" title="process" style="font-size:200%"></span>
										<a href="/../camunda/app/cockpit/default/#/process-instance/#{activity.calledProcessInstanceId}/history" target="_blank">
												#{activity.caseActivityName}											
										</a>
									</h:panelGroup>									
									<h:panelGroup rendered="#{activity.taskId!=null}">
									<span class="icon-user" title="user" style="font-size:200%"></span>
										#{activity.caseActivityName}	
										<h:panelGroup rendered="#{activity.caseActivityName=='comment from co-underwriter'}">
											<br/>#{caseController.caseVariables['coComment']}
										</h:panelGroup>	
										<h:panelGroup rendered="#{activity.caseActivityName=='review interview result'}">
											<br/>#{caseController.caseVariables['interviewResult']}
										</h:panelGroup>	

									</h:panelGroup>							        
								</h:column>
								</h:dataTable>

							</h:form>
						</div>
					</div>
				</div>
			</div>
		

		

		</h:body>
	</ui:define>
</ui:composition>